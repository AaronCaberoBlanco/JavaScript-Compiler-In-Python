\documentclass[11pt, , a4paper, titlepage]{article}
\setlength{\parindent}{0pt} % quitamos indentacion automática en parrafos

% \addtolength{\textwidth}{+100cm}

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[spanish]{babel}
% \usepackage{lmodern}
\usepackage{blindtext}
\usepackage{float}
\usepackage{vmargin}
\usepackage[hidelinks]{hyperref}
\usepackage{url}
\usepackage{lipsum}
\usepackage{adforn} % símbolo lista
\usepackage{graphicx}

% PA LA PROXIMA, HAY QUE TENERLO EN CUENTA DESDE EL PRINCIPIO 
% \setmargins{3cm}       % margen izquierdo
% {1cm}                        % margen superior
% {16.5cm}                      % anchura del texto
% {23.42cm}                    % altura del texto
% {10pt}                           % altura de los encabezados
% {2cm}                           % espacio entre el texto y los encabezados
% {0pt}                             % altura del pie de página
% {1.5cm}                           % espacio entre el texto y el pie de página


\usepackage[dvipsnames]{xcolor}
\usepackage{csquotes}   
\usepackage[style=numeric-comp, sorting=none, block=par]{biblatex} 
\addbibresource{references.bib}
\DeclareFieldFormat{title}{\bfseries\emph{#1}}
\definecolor{softblack}{RGB}{74, 71, 71} 
\DeclareFieldFormat{howpublished}{\textcolor{softblack}{\mdseries{#1}}}
\DeclareFieldFormat{labelnumberwidth}{\mkbibbold{#1\adddot}}
\setlength\bibitemsep{2.5\itemsep}
\renewcommand*{\newunitpunct}{\addspace}
\renewcommand*{\finentrypunct}{\addspace}
% \renewcommand\mkbibnamefamily[1]{\textbf{#1}}

% \usepackage{xurl} % tiene que estar despues de biblatex

\usepackage{tocloft}
% \setlength{\cftbeforesecskip}{6pt}
\setlength{\cftbeforesubsecskip}{6pt}
\setlength{\cftbeforesubsubsecskip}{3pt}


\usepackage{titlesec}
\definecolor{gray75}{gray}{0.75}
\newcommand{\hsp}{\hspace{20pt}}
\titleformat{\section}[hang]{\LARGE\bfseries}{\thesection\hsp\textcolor{gray75}{|}\hsp}{0pt}{\LARGE\bfseries}
\titlespacing{\section}{0pt}{0pt}{15pt}
\titleformat{\subsection}[hang]{\Large\bfseries}{\thesubsection\hsp}{0pt}{\Large\bfseries}
\titlespacing{\subsection}{0pt}{35pt}{15pt}
\titleformat{\subsubsection}[hang]{\large\bfseries}{\thesubsubsection\hspace{10pt}}{0pt}{\large\bfseries} 
\titlespacing{\subsubsection}{0pt}{20pt}{0pt}


\newenvironment{myitemize}
{ \begin{itemize}
    \setlength{\itemsep}{0pt}
    \setlength{\parskip}{2pt}    }
{ \end{itemize}                  } 
    
\newcommand{\minus}{\scalebox{0.75}[1.0]{$-$}}
    
\newenvironment{changemargin}[2]{%
\begin{list}{}{%
\setlength{\topsep}{0pt}%
\setlength{\leftmargin}{#1}%
\setlength{\rightmargin}{#2}%
\setlength{\listparindent}{\parindent}%
\setlength{\itemindent}{\parindent}%
\setlength{\parsep}{\parskip}%
}%
\item[]}{\end{list}}



\renewcommand*{\ttdefault}{\familydefault}

\usepackage{fancyvrb}

% redefine \VerbatimInput
\RecustomVerbatimCommand{\VerbatimInput}{VerbatimInput}%
{fontfamily=cmr, % no hace falta si se cambia ttdefault
 codes={\catcode`$=3},
 commandchars=\#\[\] % escape character and argument delimiters for
                       % commands within the verbatim
}
  
\usepackage{booktabs}
\usepackage{listings}
  
\lstdefinelanguage{JavaScript}{
  morekeywords=[1]{break, continue, delete, else, for, function, if, in,
    new, return, this, typeof, var, void, while, with, let},
  % Literals, primitive types, and reference types.
  morekeywords=[2]{false, null, true, boolean, number, string, undefined,
    Array, Boolean, Date, Math, Number, String, Object},
  % Built-ins. 
  morekeywords=[3]{eval, parseInt, parseFloat, escape, unescape},
  sensitive,
  morecomment=[s]{/*}{*/},
  morecomment=[l]//,
  morecomment=[s]{/**}{*/}, % JavaDoc style comments
  morestring=[b]',
  morestring=[b]"
}[keywords, comments, strings]

\definecolor{mediumgray}{rgb}{0.3, 0.4, 0.4}
\definecolor{mediumblue}{rgb}{0.0, 0.0, 0.8}
\definecolor{forestgreen}{rgb}{0.13, 0.55, 0.13}
\definecolor{darkviolet}{rgb}{0.58, 0.0, 0.83}
\definecolor{royalblue}{rgb}{0.25, 0.41, 0.88}
\definecolor{crimson}{rgb}{0.86, 0.8, 0.24}

\lstdefinestyle{JSES6Base}{
    backgroundcolor=\color{white},
    basicstyle=\ttfamily,
    breakatwhitespace=false,
    breaklines=false,
    captionpos=b,
    columns=fullflexible,
    commentstyle=\color{mediumgray}\upshape,
    emph={},
    emphstyle=\color{crimson},
    extendedchars=true,  % requires inputenc
    literate={á}{{\'a}}1 {é}{{\'e}}1 {í}{{\'i}}1 {ó}{{\'o}}1 {ú}{{\'u}}1,
    fontadjust=true,
    frame=single,
    identifierstyle=\color{black},
    keepspaces=true,
    keywordstyle=\color{mediumblue},
    keywordstyle={[2]\color{darkviolet}},
    keywordstyle={[3]\color{royalblue}},
    numbers=none,
    rulecolor=\color{black},
    showlines=false,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    stringstyle=\color{forestgreen},
    tabsize=2,
    upquote=true,  % requires textcomp
    numbers=left, numberstyle=\scriptsize
}

\lstdefinestyle{JavaScript}{
  language=JavaScript,
  style=JSES6Base
}


% \usepackage{geometry}
%  \geometry{
%  a4paper,
%  total={210mm,297mm},
%  left=60mm,
%  right=20mm,
%  top=40mm,
%  bottom=20mm,
%  }
 
% \usepackage{fancyhdr}

% \pagestyle{fancy}
% \fancyhead[LO,LE]{Curso 2020/2021}
% \fancyhead[CO,CE]{Grado en Ingeniería Informática}
% \fancyfoot[CO,CE]{\thepage}

% \renewcommand{\headrulewidth}{0.4pt} % grosor de la línea de la cabecera
% \renewcommand{\footrulewidth}{0.4pt} % grosor de la línea del pie
% \usepackage{pdfpages} % to include external pdf's

% \setpapersize{A4}
% \setmargins{2.5cm}       % margen izquierdo
% {1cm}                        % margen superior
% {16.5cm}                      % anchura del texto
% {23.42cm}                    % altura del texto
% {10pt}                           % altura de los encabezados
% {2cm}                           % espacio entre el texto y los encabezados
% {0pt}                             % altura del pie de página
% {2cm}                           % espacio entre el texto y el pie de página

% \usepackage{geometry}
%  \geometry{
%  a4paper,
%  total={170mm,257mm},
%  left=20mm,
%  top=20mm,
%  }

% \title{Ejercicio Individual II}
% \author{Daniel Tomás Sánchez\\ asdas\\ dfsf}
% \date{Diciembre 2020}

\begin{document}
% Cuerpo del documento
\begin{titlepage}
    \begin{center}
        \hrulefill

        \vspace{0.5cm}
        {\bfseries\Huge Traductores de Lenguajes \par}
        \vspace{3cm}

        {\scshape \LARGE \textbf{Memoria Final}}

        \hrulefill

        \vspace{2.0cm}
    \end{center}

    \centering

    % {\scshape\Huge\textbf{}\par}
    % \vspace{1cm}
    % {\scshape\Huge\textbf{Ejercicio Individual II}\par}
    % \vspace{3cm}

    \Large{Grupo 55}\\
    \vspace{0.3cm}

    {\large Daniel Tomás Sánchez\\ Aarón Cabero Blanco\\ Alejandro Cuadrón Lafuente\par}

    \vspace{2cm}
    {\Large Curso 2020/2021 \par}
\end{titlepage}

%\maketitle

% \clearpage
\tableofcontents
\clearpage


\section{Introducción}
Hemos decidido usar, como lenguaje de programación, Python, ya que nos apetecía aprender un lenguaje nuevo, además de que es muy usado en la industria.\\
El trabajo completo, tanto el léxico, como el sintáctico y el semático, ha sido realizado con la herramienta o librería externa "SLY" \cite{SLY}.\\

Opciones de grupo:
\begin{myitemize}
    \renewcommand{\labelitemi}{$\circ$}
    \item Sentencias: Sentencia repetitiva (\textbf{for})
    \item   Operadores especiales: Post-auto-decremento (\textbf{\minus \minus \hspace{0.1cm} como sufijo})
    \item     Técnicas de Análisis Sintáctico: \textbf{Ascendente}
    \item     Comentarios: Comentario de bloque (\textbf{/* */})
    \item Cadenas: Con comillas dobles (\textbf{" \phantom{} "})
\end{myitemize}
\clearpage

\section{Diseño Analizador Léxico}

% % LO SUYO hubiese sido hacerlo asi
% \newcommand{\fila}[2]{$\bullet$ & #1 & <#2>\\}
% \begin{tabular}{cll}
% \fila{Identificador}{ID, punteroTS}
% \fila{Palabra reservada Number}{<NUMBER, ->}
% \end{tabular}

\begin{changemargin}{0cm}{+4cm}
    \subsection{Tokens}
    \begin{flushleft}
        \begin{myitemize}
            \item Identificador \hfill<ID, punteroTS>
            \item Constante entera \hfill<CTEENTERA, valor>
            \item Cadena de caracteres \hfill<CADENA, lexema>
            \item false \hfill<CTELOGICA, 0>
            \item true \hfill<CTELOGICA, 1>
            \item Palabra reservada Number\hfill<NUMBER, ->
            \item Palabra reservada String\hfill<STRING, ->
            \item Palabra reservada Boolean\hfill<BOOLEAN, ->
            \item Palabra reservada Let\hfill<LET, ->
            \item Palabra reservada Alert\hfill<ALERT, ->
            \item Palabra reservada Input\hfill<INPUT, ->
            \item Palabra reservada Function\hfill<FUNCTION, ->
            \item Palabra reservada Return \hfill<RETURN, ->
            \item Palabra reservada If \hfill<IF, ->
            \item Palabra reservada For\hfill<FOR, ->
            \item \minus \minus \hfill<OPESP, ->
            \item \minus  \hfill<OPARIT, ->
            \item =\hfill <OPASIG, ->
            \item == \hfill<OPREL, ->
            \item \&\& \hfill<OPLOG, ->
            \item ( \hfill<ABPAREN, ->
                  \item ) \hfill<CEAPAREN,>
            \item \{ \hfill<ABLLAVE, ->
            \item \} \hfill<CELLAVE, ->
            \item , \hfill<COMA, ->
            \item ; \hfill<PUNTOYCOMA, ->
        \end{myitemize}
    \end{flushleft}
\end{changemargin}
\clearpage

\subsection{Gramática Regular}
\noindent
Axioma = A\\
A $\rightarrow$ del A $|$ d D $|$ " \hspace{1mm} S $|$ / C $|$ l I $|$ \minus  M $|$ = E $|$ \& N $|$ ( $|$ ) $|$ \{ $|$ \} $|$ ; $|$ , \\
D $\rightarrow$ d D $|$ $\lambda$\\
S $\rightarrow$ " \hspace{1mm} $|$ c S\\
C $\rightarrow$ * C'\\
C' $\rightarrow$ * C'' $|$ c C'\\
C'' $\rightarrow$ / A $|$ c C'\\
I $\rightarrow$ d I $|$ l I $|$ \_ I $|$ $\lambda$\\
M $\rightarrow$ \minus \hspace{1.5mm}$|$ $\lambda$\\
E $\rightarrow$ = $|$ $\lambda$\\
N $\rightarrow$ \&\\
\\
Siendo $d$ un dígito, $l$ una letra, $c$ cualquier otro carácter y $del$ un delimitador.

\subsection{Autómata Finito Determinista}
\begin{center}
    \includegraphics[scale=0.33]{./resources/automata.jpg}
\end{center}
\clearpage

\subsection{Acciones Semánticas}
\begin{flushleft}
    A: leer\\
    B: number = int(d), leer\\
    C: number = number * 10 + int(d), leer\\
    D: if number >\hspace{1mm} 32767\\
    \qquad pError("Número fuera de rango")\\
    \quad else \\
    \qquad genToken(CTEENTERA, number);\\
    E: string = \verb|""|, contador = 0, leer\\
    F: string = string + otroCS, contador++, leer\\
    G: if contador >\hspace{1mm} 64\\
    \qquad pError(\verb|"Cadena| demasiado larga")\\
    \quad else\\
    \qquad genToken(CADENA, string)\\
    \quad leer\\
    H: string = l, leer\\
    I: string = string + l/D/\_ , leer\\
    J: if palabrasReservadas.contains(string)\\
    \qquad if string == "number"\\
    \qquad \quad      genToken(NUMBER, -)\\
    \qquad elif string == "string"\\
    \qquad \quad     genToken(STRING,-)\\
    \qquad  elif string == "boolean"\\
    \qquad \quad      genToken(BOOLEAN, -)\\
    \qquad    elif string == "let"\\
    \qquad \quad      genToken(LET, -)\\
    \qquad    elif string == "\phantom{}alert"\\
    \qquad \quad      genToken(ALERT, -)\\
    \qquad    elif string == "\phantom{}input"\\
    \qquad \quad      genToken(INPUT, -)\\
    \qquad    elif string == "\phantom{}return"\\
    \qquad \quad       genToken(RETURN, -)\\
    \qquad     elif string == "\phantom{}if"\\
    \qquad \quad       genToken(IF, -)\\
    \qquad     else\\
    \qquad \quad      genToken(FOR, -)\\
    \clearpage
    \quad       else \hspace{5mm} // palabrasReservadas.contains(string) = False\\
    \qquad          puntero = TS.get(string)\\
    \qquad          if zona\_decl == True\\
    \qquad \quad        if puntero != None\\
    \qquad \quad \quad      pError("\phantom{}Identificador ya declarado")\\
    \qquad \quad        else\\
    \qquad \quad \quad      TS.update({string})\\
    \qquad \quad \quad      puntero = TS.get(string)\\
    \qquad \quad \quad      genToken(ID, puntero)\\
    \qquad          else\\
    \qquad \quad        if puntero == None\\
    \qquad \quad \quad      TS.update({string})\\
    \qquad \quad \quad      puntero = TS.get(string)\\
    \qquad \quad \quad      genToken(ID, puntero)\\
    \qquad \quad        else\\
    \qquad \quad \quad      genToken(ID, puntero)\\
    \vspace{\baselineskip}
    L: genToken(OPARIT, -)\\
    M: genToken(OPESP, -), leer\\
    N: genToken(OPASIG, -)\\
    O: genTokeN(OPREL, -), leer\\
    P: genToken(OPLOG, -), leer\\
    Q: genToken(ABPAREN, -), leer\\
    R: genToken(CEPAREN, -), leer\\
    S: genToken(ABLLAVE, -), leer\\
    T: genToken(CELLAVE, -), leer\\
    U: genToken(COMA, -), leer\\
    V: genToken(PUNTOYCOMA, -), leer\\
    W: genToken(EOF, -), leer\\
\end{flushleft}

\subsection{Errores}
Error léxico (siempre se lanza cuando el analizador léxico encuentra un error).
\begin{enumerate}
    \item Cadena con longitud mayor de 64 caracteres.
    \item Número fuera de rango (mayor de 32767).
    \item Identificador ya declarado.
    \item Carácter ilegal.
\end{enumerate}
Todo error va acompañado de la $linea$ y $columna$ en el que se ha encontrado dicho error.
\clearpage

\section{Diseño Analizador Sintáctico}

\subsection{Gramática}
Axioma = B\\
No Terminales = \{ A B C D E F G H I J K L M N O P Q R S T U V W F1 F2 F3 \}\\
Terminales = \{ \&\& == \minus \hspace{0.1cm} \minus\minus \hspace{0.1cm} (\hspace{0.1cm}  ) =\hspace{0.1cm}  ,\hspace{0.1cm}  ; { } id %
ent cad log let alert input return for if number\\
\hspace*{2.65cm}boolean string function \}\\\\
Producciones = \{\\
\setlength{\tabcolsep}{1.5cm}
\begin{tabular}{ l l }
    B $\rightarrow$ D                       & O $\rightarrow$ $\lambda$                      \\
    D $\rightarrow$ F D                     & C $\rightarrow$ G C                            \\
    D $\rightarrow$ G D                     & C $\rightarrow$ $\lambda$                      \\
    D $\rightarrow$ $\lambda$               & F $\rightarrow$ F1 F2 F3                       \\
    G $\rightarrow$ if ( E ) S              & F1 $\rightarrow$ function P Q id               \\
    G $\rightarrow$ S                       & P $\rightarrow$ $\lambda$                      \\
    S $\rightarrow$ H ;                     & Q $\rightarrow$ T                              \\
    H $\rightarrow$ id ( I )                & Q $\rightarrow$ $\lambda$                      \\
    I $\rightarrow$ E J                     & F2 $\rightarrow$ ( A )                         \\
    I $\rightarrow$ $\lambda$               & A $\rightarrow$ T id AA                        \\
    J $\rightarrow$ , E J                   & A $\rightarrow$ $\lambda$                      \\
    J $\rightarrow$ $\lambda$               & AA $\rightarrow$ , T id AA                     \\
    S $\rightarrow$ K ;                     & AA $\rightarrow$ $\lambda$                     \\
    K $\rightarrow$ id = E                  & F3 $\rightarrow$ { C }                         \\
    S $\rightarrow$ alert ( E ) ;           & E $\rightarrow$ E \&\& R                       \\
    S $\rightarrow$ input ( id ) ;          & E $\rightarrow$ R                              \\
    S $\rightarrow$ return L ;              & R $\rightarrow$ R == U                         \\
    L $\rightarrow$ E                       & R $\rightarrow$ U                              \\
    L $\rightarrow$ $\lambda$               & U $\rightarrow$ U \minus\hspace{0.1cm} V       \\
    G $\rightarrow$ let M T id ;            & U $\rightarrow$ V                              \\
    M $\rightarrow$ $\lambda$               & V $\rightarrow$ \minus\minus \hspace{0.1cm} id \\
    T $\rightarrow$ number                  & V $\rightarrow$ id                             \\
    T $\rightarrow$ boolean                 & V $\rightarrow$ ( E )                          \\
    T $\rightarrow$ string                  & V $\rightarrow$ H                              \\
    G $\rightarrow$ for ( N ; E ; O ) { C } & V $\rightarrow$ ent                            \\
    N $\rightarrow$ K                       & V $\rightarrow$ cad                            \\
    N $\rightarrow$ $\lambda$               & V $\rightarrow$ log                            \\
    O $\rightarrow$ K                                                                        \\
    O $\rightarrow$ \minus\minus \hspace{0.1cm} id
\end{tabular}
\\\}
\clearpage

\subsection{Tabla LR(1) }
\begin{changemargin}{-2.5cm}{+2.5cm}
    \begin{center}
        \includegraphics[width=1.27\textwidth]{./resources/tabla-LR/Tabla1.jpg}
        \includegraphics[width=1.27\textwidth]{./resources/tabla-LR/Tabla2.jpg}
        \includegraphics[width=1.27\textwidth]{./resources/tabla-LR/Tabla3.jpg}
        \includegraphics[width=1.27\textwidth]{./resources/tabla-LR/Tabla4.jpg}
        \includegraphics[width=1.27\textwidth]{./resources/tabla-LR/Tabla5.jpg}
    \end{center}
\end{changemargin}

\vspace{3mm}
Como puede observarse en la tabla\cite{TABLA-LR}, esta gramática es adecuada para este tipo de analizador sintáctico, puesto que no se produce ningún tipo de conflicto.
\clearpage

\section{Diseño Analizador Semántico}
\VerbatimInput{Pseudo-PDL.txt}
\clearpage

\section{Diseño Tabla de Símbolos}
La TS se compone de una lista de tablas, una de ellas es global y se crea al empezar, mientras que el resto son locales y se van creando %
a medida que avanza la compilación. Están ordenadas en orden de creación. %
Cada tabla tiene un flag que indica si la tabla existe (esta activa) o se ha eliminado, pero realmente no las eliminamos para posteriormente imprimirlas.

A su vez cada tabla contiene una lista de diccionarios, cada diccionario simboliza una entrada en la tabla de símbolos. %
Un diccionario es un hashmap que tiene como claves la palabra \verb|"lexema"| y los tipos de atributos que le corresponda %
(por ejemplo \verb|"Tipo" ó "Despl"|), como valores tiene el valor del lexema y de sus atributos en si mismos (por ejemplo \verb|"main" ó "entero"|).
\clearpage

\section{Anexo}


\subsection{Casos de prueba correctos}

\renewcommand*{\ttdefault}{cmtt}

\RecustomVerbatimCommand{\VerbatimInput}{VerbatimInput}%
{fontsize=\small,
    fontfamily=cmr, % no hace falta si se cambia ttdefault
    codes={\catcode`$=3},
    commandchars=\#\[\] % escape character and argument delimiters for
    % commands within the verbatim
}

\subsubsection{Prueba correcta 1}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-1/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Tokens:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-1/Tokens.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Tabla de símbolos:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-1/TS-Output.txt}
    \end{changemargin}

    \vspace{2mm}
    \clearpage

    \textbf{VASt:}
    \vspace{1mm}
    \begin{center}
        \includegraphics[width=1.4\textwidth]{./resources/test-cases/case-1/tree.jpg}
    \end{center}

\end{changemargin}
\clearpage

\subsubsection{Prueba correcta 2}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-2/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Tokens:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-2/Tokens.txt}
    \end{changemargin}

    \vspace{3mm}

    \textbf{Tabla de símbolos:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-2/TS-Output.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{VASt:}
    \vspace{1mm}
    \begin{center}
        \includegraphics[width=0.8\textwidth]{./resources/test-cases/case-2/tree.jpg}
    \end{center}

\end{changemargin}

\subsubsection{Prueba correcta 3}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-3/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Tokens:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-3/Tokens.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Tabla de símbolos:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-3/TS-Output.txt}
    \end{changemargin}

    \clearpage

    \textbf{VASt:}
    \vspace{1mm}
    \begin{center}
        \includegraphics[width=1.4\textwidth]{./resources/test-cases/case-3/tree.jpg}
    \end{center}

\end{changemargin}
\clearpage

\subsubsection{Prueba correcta 4}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-4/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Tokens:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-4/Tokens.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Tabla de símbolos:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-4/TS-Output.txt}
    \end{changemargin}

    \clearpage

    \textbf{VASt:}
    \vspace{1mm}
    \begin{center}
        \includegraphics[width=0.54\textwidth]{./resources/test-cases/case-4/tree.jpg}
    \end{center}

\end{changemargin}
\clearpage

\subsubsection{Prueba correcta 5}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-5/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Tokens:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-5/Tokens.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Tabla de símbolos:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-5/TS-Output.txt}
    \end{changemargin}

    \vspace{2mm}
    \clearpage

    \textbf{VASt:}
    \vspace{1mm}
    \begin{center}
        \includegraphics[width=0.5\textwidth]{./resources/test-cases/case-5/tree.jpg}
    \end{center}

\end{changemargin}


\subsection{Casos de prueba erróneos}

\subsubsection{Prueba errónea 1}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-6/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Mensaje de error:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-6/Error.txt}
    \end{changemargin}

\end{changemargin}

\subsubsection{Prueba errónea 2}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-7/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Mensaje de error:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-7/Error.txt}
    \end{changemargin}

\end{changemargin}

\subsubsection{Prueba errónea 3}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-8/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Mensaje de error:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-8/Error.txt}
    \end{changemargin}

\end{changemargin}

\subsubsection{Prueba errónea 4}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-9/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Mensaje de error:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-9/Error.txt}
    \end{changemargin}

\end{changemargin}

\subsubsection{Prueba errónea 5}

\begin{changemargin}{+0.5cm}{+0cm}
    \vspace{1mm}

    \textbf{Programa introducido:}
    \begin{changemargin}{+0.5cm}{+0cm}
        \lstinputlisting[style=JavaScript]{./resources/test-cases/case-10/Input.txt}
    \end{changemargin}

    \vspace{2mm}

    \textbf{Mensaje de error:}
    \vspace{1mm}
    \begin{changemargin}{+0.5cm}{+0cm}
        \VerbatimInput{./resources/test-cases/case-10/Error.txt}
    \end{changemargin}

\end{changemargin}

% \vspace{10mm}

\clearpage

\section{Diseño del generador de código intermedio}

% % LO SUYO hubiese sido hacerlo asi
% \newcommand{\fila}[2]{$\bullet$ & #1 & <#2>\\}
% \begin{tabular}{cll}
% \fila{Identificador}{ID, punteroTS}
% \fila{Palabra reservada Number}{<NUMBER, ->}
% \end{tabular}

Para diseñar el generador de código intermedio nos basamos en la gramática empleada en la práctica de PDL.
El diseño resultante es el siguiente: \\ \\

\VerbatimInput{GCI2.txt}

\clearpage

\section{Diseño del registro de activación}
El registro de activación considerado para la práctica es el siguiente: \\
\begin{table}[H]
    \centering
    \begin{tabular}{ l c }
    Estado de la máquina & EM \\
    Parámetros actuales  & P  \\
    Variables locales    & VL \\
    Datos temoporales    & DT \\
    Valor devuelto       & VD
    \end{tabular}
\end{table}

Se han suprimido tanto el PC como el PA. El primero se debe a que los diferentes RAs se almacenan
en pila uno encima del anterior, por lo tanto no es necesario almacenar la dirección del antiguo RA que llamó a este.
El segundo se ha suprimido porque al no haber funciones anidadas en nuestro lenguaje no hay necesidad de almacenar un PA. \\ \\
El campo valor devuelto (VD), se ha implementado en la práctica usando un registro. Es decir, en lugar de extraer el resultado de la función
del campo VD, se almacena en un registro y de este registro se extrae dicho valor. Más adelante mostrará en CO su uso.

\clearpage

\section{Diseño del código objeto}

\subsection{Métodos auxiliares}
% \subsubsection{Store\_in\_reg}
% \subsubsection{Copy\_str}

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Método auxiliar} & \large \textbf{Código objeto} \\
        \hline  & \\[-2mm]
        store\_in\_reg(oper, REG, mode) 
        & if oper is global:  \\
        & \hspace*{6mm} if mode is direccion: \\
        & \hspace*{6mm} \hspace*{6mm}  ADD \#DESP, .IY \\
        & \hspace*{6mm} \hspace*{6mm}  MOVE .A, REG \\
        & \hspace*{6mm} else if mode is valor: \\
        & \hspace*{6mm} \hspace*{6mm}  ADD \#DESP, .IY \\
        & \hspace*{6mm} \hspace*{6mm}  MOVE .A, .R9 \\
        & \hspace*{6mm} \hspace*{6mm}  MOVE [.R9], REG \\
        & else if oper is local:  \\
        & \hspace*{6mm} if mode is direccion: \\
        & \hspace*{6mm} \hspace*{6mm}  ADD \#DESP, .IX \\
        & \hspace*{6mm} \hspace*{6mm}  MOVE .A, REG \\
        & \hspace*{6mm} else if mode is valor: \\
        & \hspace*{6mm} \hspace*{6mm}  ADD \#DESP, .IX \\
        & \hspace*{6mm} \hspace*{6mm}  MOVE .A, .R9 \\
        & \hspace*{6mm} \hspace*{6mm}  MOVE [.R9], REG \\
        & else if oper is entero:  \\
        & \hspace*{6mm}  if mode is valor: \\
        & \hspace*{6mm} \hspace*{6mm}  MOVE \#LITERAL, REG \\
        & else if oper is cadena:  \\
        & \hspace*{6mm}  if mode is direccion: \\
        & \hspace*{6mm} \hspace*{6mm}  MOVE \#etiqCad, REG
        \vspace{2mm} \\
        \hline  & \\[-2mm]
        copy\_str(REG\_ORIGEN, REG\_DESTINO)
        & copiaN: NOP \\
        & MOVE [REG\_ORIGEN], .R9 \\
        & MOVE .R9, [REG\_DESTINO] \\
        & ADD \#1, REG\_ORIGEN \\
        & MOVE .A, REG\_ORIGEN \\
        & ADD \#1, REG\_DESTINO \\
        & MOVE .A, REG\_DESTINO \\
        & CMP \#0, .R9 \\
        & BNZ \/copiaN
        \vspace{2mm} \\
        \hline
    \end{tabular}
\end{table}

\subsection{Aritméticas y lógicas}

Operación $"AND"$ lógico:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [=and, op1, op2, res] 
        & store\_in\_reg(op1, .R1, Value) \\
        & store\_in\_reg(op2, .R2, Value) \\
        & store\_in\_reg(res, .R3, Dir) \\
        & AND .R1, .R2 \\
        & MOVE .A, [.R3]
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Operación resta aritmética:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [=-, op1, op2, res] 
        & store\_in\_reg(op1, .R1, Value) \\
        & store\_in\_reg(op2, .R2, Value) \\
        & store\_in\_reg(res, .R3, Dir) \\
        & SUB .R1, .R2 \\
        & MOVE .A, [.R3]
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

\subsection{Asignaciones}
Asignación de un entero o lógico:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [=EL, op1, , res] 
        & store\_in\_reg(op1, .R1, Value) \\
        & store\_in\_reg(res, .R3, Dir) \\
        & MOVE .R1, [.R3]
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Asignación de una cadena:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline & \\[-2mm]
        [=Cad, op1, , res] 
        & store\_in\_reg(op1, .R1, Dir) \\
        & store\_in\_reg(res, .R3, Dir) \\
        & copy\_str(.R1, .R3)
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

\subsection{Saltos y etiquetas}

Añadir una etiqueta:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline & \\[-2mm]
        [:, etiqueta, ,] 
        & etiqueta: NOP
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Salto a una etiqueta:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline & \\[-2mm]
        [goto, , , etiqueta] 
        & BR /etiqueta
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Salto en caso de igual:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [if=goto, op1, op2, etiqueta] 
        & store\_in\_reg(op1, .R1, Value) \\
        & store\_in\_reg(op2, .R2, Value) \\
        & CMP .R1 .R2 \\
        & BZ /etiqueta
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

\subsection{Paso de parámetros}

Paso de un entero o lógico:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [paramEL, op1, , ] 
        & store\_in\_reg(op1, .R1, Dir) \\
        & ADD \#Tam\_RA\_Actual, .IX \\
        & ADD \#X, .A \\
        & MOVE [.R1], [.A]
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Paso de una cadena:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [paramCAD, op1, , ] 
        & store\_in\_reg(op1, .R1, Dir) \\
        & ADD \#Tam\_RA\_Actual, .IX \\
        & ADD \#X, .A \\
        & MOVE A, .R3 \\
        & copy\_str(.R1,.R3)
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

\subsection{Llamadas}
 
Llamada a una funcion que no devuelve nada:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [callVoid,etiqueta , , ] 
        & ADD \#Tam\_RA\_Actual, .IX \\
        & MOVE \#Dir\_Ret, [.A] \\
        & MOVE .A, .IX \\
        & BR /etiqueta \\
        & Dir\_Ret: NOP\\
        & SUB .IX, \#Tam\_RA\_Actual\\
        & MOVE .A, .IX
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Llamada a una funcion devuelve entero o logico:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [callValueEL, etiqueta, , res] 
        & ADD \#Tam\_RA\_Actual, .IX \\
        & MOVE \#Dir\_Ret, [.A] \\
        & MOVE .A, .IX \\
        & BR /etiqueta \\
        & Dir\_Ret: NOP\\
        & SUB .IX, \#Tam\_RA\_Actual\\
        & MOVE .A, .IX \\
        & store\_in\_reg(res, .R3, Dir) \\
        & MOVE .Reg\_Ret, [.R3]
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Llamada a una funcion devuelve una cadena:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [callValueCAD, etiqueta, , res] 
        & ADD \#Tam\_RA\_Actual, .IX \\
        & MOVE \#Dir\_Ret, [.A] \\
        & MOVE .A, .IX \\
        & BR /etiqueta \\
        & Dir\_Ret: NOP\\
        & SUB .IX, \#Tam\_RA\_Actual\\
        & MOVE .A, .IX \\
        & store\_in\_reg(res, .R3, Dir) \\
        & copy\_str(.Reg\_Ret, .R3)
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

\subsection{Sentencias de retorno}

Return sin valor devuelto:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [returnVoid, , ,] 
        & BR [.IX]
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Return de entero o lógico:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [returnEL, op1, , ]
        & store\_in\_reg(op1, .Reg\_Ret, Value)\\ 
        & BR [.IX]
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Return de una cadena:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [returnCAD, op1, , ]
        & store\_in\_reg(op1, .Reg\_Ret, Dir)\\ 
        & BR [.IX]
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

\subsection{Alerts e inputs}

Alert de un entero:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [alertEnt, op1, , ]
        & store\_in\_reg(op1, .Reg\_Aux, Value)\\ 
        & WRINT .Reg\_Aux
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Alert de una cadena:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [alertCad, op1, , ]
        & store\_in\_reg(op1, .Reg\_Aux, Dir)\\ 
        & WRSTR .Reg\_Aux
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Input de un entero:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [inputEnt, op1, , ]
        & store\_in\_reg(op1, .Reg\_Aux, Dir)\\ 
        & ININT .Reg\_Aux
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

Input de una cadena:

\begin{table}[H]
    \centering
    \begin{tabular}{cl}
        \large \textbf{Código intermedio} & \large \textbf{Código objeto} \\ 
        \hline  & \\[-2mm]
        [inputCad, op1, , ]
        & store\_in\_reg(op1, .Reg\_Aux, Dir)\\ 
        & INSTR .Reg\_Aux
        \vspace{2mm} \\
        \hline 
    \end{tabular}
\end{table}

\clearpage
\section{Anexo}
A continuación se listan las cinco pruebas solicitadas.


\subsection{Prueba 1 - test del for}
\vspace{2mm}
Contenido de la prueba:
\vspace{2mm}
\begin{changemargin}{+3cm}{+2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 1 - Aaron/test-for.js}
\end{changemargin} 
\vspace{2mm}
Contenido del CI:
\vspace{2mm}
\begin{changemargin}{+1cm}{+0cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 1 - Aaron/test-for.ci}
\end{changemargin} 
\vspace{2mm}
Contenido del CO:
\vspace{2mm}
\begin{changemargin}{+1cm}{-2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 1 - Aaron/test-for.ens}
\end{changemargin} 

\clearpage

\subsection{Prueba 2 - test de operaciones entrada y salida}
\vspace{2mm}
Contenido de la prueba:
\vspace{2mm}
\begin{changemargin}{+3cm}{+2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 2 - Aaron/test-inout.js}
\end{changemargin} 
\vspace{2mm}
Contenido del CI:
\vspace{2mm}
\begin{changemargin}{+1cm}{+0cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 2 - Aaron/test-inout.ci}
\end{changemargin} 
\vspace{2mm}
Contenido del CO:
\vspace{2mm}
\begin{changemargin}{+1cm}{-2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 2 - Aaron/test-inout.ens}
\end{changemargin} 

\clearpage

\subsection{Prueba 3 - test genérico}
\vspace{2mm}
Contenido de la prueba:
\vspace{2mm}
\begin{changemargin}{+3cm}{+2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 3 - Aaron/test-random.js}
\end{changemargin} 
\vspace{2mm}
Contenido del CI:
\vspace{2mm}
\begin{changemargin}{+1cm}{+0cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 3 - Aaron/test-random.ci}
\end{changemargin} 
\vspace{2mm}
Contenido del CO:
\vspace{2mm}
\begin{changemargin}{+1cm}{-2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 3 - Aaron/test-random.ens}
\end{changemargin} 

\clearpage

\subsection{Prueba 4 - test recursivo}
\vspace{2mm}
Contenido de la prueba:
\vspace{2mm}
\begin{changemargin}{+3cm}{+2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 4 - Daniel/test-rec.js}
\end{changemargin} 
\vspace{2mm}
Contenido del CI:
\vspace{2mm}
\begin{changemargin}{+1cm}{+0cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 4 - Daniel/test-rec.ci}
\end{changemargin} 
\vspace{2mm}
Contenido del CO:
\vspace{2mm}
\begin{changemargin}{+1cm}{-2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 4 - Daniel/test-rec.ens}
\end{changemargin} 

\clearpage

\subsection{Prueba 5 - test llamadas a funciones}
\vspace{2mm}
Contenido de la prueba:
\vspace{2mm}
\begin{changemargin}{+3cm}{+2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 5 - Alejandro/test-nested-functions.js}
\end{changemargin} 
\vspace{2mm}
Contenido del CI:
\vspace{2mm}
\begin{changemargin}{+1cm}{+0cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 5 - Alejandro/test-nested-functions.ci}
\end{changemargin} 
\vspace{2mm}
Contenido del CO:
\vspace{2mm}
\begin{changemargin}{+1cm}{-2cm}
    \lstinputlisting[style=JavaScript]{./resources/global-tests/Prueba 5 - Alejandro/test-nested-functions.ens}
\end{changemargin} 


\clearpage
\printbibliography[heading=bibnumbered]



\end{document}
